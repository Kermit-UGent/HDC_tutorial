include("hdc_tutorial.jl")

punctuation = "_.'?!;:,,*)%([]"

remove_punctuation = string -> replace(string, (p => "" for p in punctuation)...)
remove_enters = string -> replace(string, r"\s+" => " ")

clean_text = remove_punctuation ∘ remove_enters ∘ lowercase

function normalize(s)
    # 1. Convert to lowercase
    s = lowercase(s)

    # 2. Keep ONLY letters and numbers (from any language)
    s = replace(s, r"[^\p{L}\p{N}\s]" => "")

    # 3. Clean up whitespace
    s = replace(s, r"\s+" => " ") |> strip

    return s
end

clean_text = normalize

wiki_english = "Deoxyribonucleic acid (DNA) is a polymer composed of two polynucleotide chains that coil around each other to form a double helix. The polymer carries genetic instructions for the development, functioning, growth and reproduction of all known organisms and many viruses. DNA and ribonucleic acid (RNA) are nucleic acids. Alongside proteins, lipids and complex carbohydrates (polysaccharides), nucleic acids are one of the four major types of macromolecules that are essential for all known forms of life. The two DNA strands are known as polynucleotides as they are composed of simpler monomeric units called nucleotides.[2][3] Each nucleotide is composed of one of four nitrogen-containing nucleobases (cytosine [C], guanine [G], adenine [A] or thymine [T]), a sugar called deoxyribose, and a phosphate group. The nucleotides are joined to one another in a chain by covalent bonds (known as the phosphodiester linkage) between the sugar of one nucleotide and the phosphate of the next, resulting in an alternating sugar-phosphate backbone. The nitrogenous bases of the two separate polynucleotide strands are bound together, according to base pairing rules (A with T and C with G), with hydrogen bonds to make double-stranded DNA. The complementary nitrogenous bases are divided into two groups, the single-ringed pyrimidines and the double-ringed purines. In DNA, the pyrimidines are thymine and cytosine; the purines are adenine and guanine. Both strands of double-stranded DNA store the same biological information. This information is replicated when the two strands separate. A large part of DNA (more than 98% for humans) is non-coding, meaning that these sections do not serve as patterns for protein sequences. The two strands of DNA run in opposite directions to each other and are thus antiparallel. Attached to each sugar is one of four types of nucleobases (or bases). It is the sequence of these four nucleobases along the backbone that encodes genetic information. RNA strands are created using DNA strands as a template in a process called transcription, where DNA bases are exchanged for their corresponding bases except in the case of thymine (T), for which RNA substitutes uracil (U).[4] Under the genetic code, these RNA strands specify the sequence of amino acids within proteins in a process called translation."
wiki_german = "Desoxyribonukleinsäure, meist kurz als DNA (Abkürzung für englisch deoxyribonucleic acid), seltener auch als DNS abgekürzt, ist eine aus unterschiedlichen Desoxyribonukleotiden aufgebaute Nukleinsäure. Sie trägt die Erbinformation bei allen Lebewesen und den DNA-Viren. Das langkettige Polynukleotid enthält in Abschnitten von Genen besondere Abfolgen seiner Nukleotide. Diese DNA-Abschnitte dienen als Matrizen für den Aufbau entsprechender Ribonukleinsäuren (RNA), wenn genetische Information von DNA in RNA umgeschrieben wird (siehe Transkription). Die hierbei an der DNA-Vorlage aufgebauten RNA-Stränge erfüllen unterschiedliche Aufgaben; sie sind als rRNA (englisch ribosomal RNA), als tRNA (englisch transfer RNA) und als mRNA (englisch messenger RNA) an der Biosynthese von Proteinen beteiligt (siehe Proteinbiosynthese). Im Falle einer messenger- oder Boten-RNA (mRNA) stellt die Abfolge von Nukleinbasen die Bauanleitung für ein Protein dar. Die Grundbausteine von DNA-Strängen sind vier verschiedene Nukleotide, die jeweils aus einem Phosphatrest, dem Zucker Desoxyribose sowie einer von vier Nukleinbasen (Adenin, Thymin, Guanin und Cytosin; oft mit A, T, G und C abgekürzt) bestehen. Die Abfolge von Basen (Nukleotidsequenz) in bestimmten DNA-Strangabschnitten enthält Information. Umgeschrieben in den Einzelstrang einer mRNA gibt deren Basensequenz bei der Proteinbiosynthese die Abfolge von Aminosäuren (Aminosäuresequenz) im zu bildenden Protein vor. Hierbei wird drei aufeinanderfolgenden Basen – je einem Basentriplett als Codon – jeweils eine bestimmte Aminosäure zugeordnet und diese mit der vorigen verknüpft, sodass ein Polypeptid entsteht. So werden an einem Ribosom mithilfe von tRNA entsprechend dem genetischen Code Bereiche der Basensequenz in eine Aminosäurensequenz übersetzt (siehe Translation). Das Genom einer Zelle liegt zumeist als DNA-Doppelstrang vor, bei dem die beiden basenpaarend einander komplementären Stränge räumlich die Form einer Doppelhelix bilden (siehe Abbildung). Bei der Replikation werden sie entwunden und getrennt jeweils durch Basenpaarung wieder komplementär ergänzt, sodass anschließend zwei (nahezu) identische doppelsträngige DNA-Moleküle vorliegen. Fehler beim Replikationsvorgang sind eine Quelle von Mutationen, die nach Kernteilung und Zellteilung in entstandenen Zellen als Veränderung genetischer Information vorliegen und weitergegeben werden können."
wiki_french = "L'acide désoxyribonucléique, ou ADN, est une macromolécule biologique présente dans presque toutes[a] les cellules ainsi que chez de nombreux virus. L'ADN contient toute l'information génétique, appelée génome, permettant le développement, le fonctionnement et la reproduction des êtres vivants. C'est un acide nucléique, au même titre que l'acide ribonucléique (ARN). Les acides nucléiques sont, avec les peptides et les glucides, l'une des trois grandes familles de biopolymères essentiels à toutes les formes de vie connues. Les molécules d'ADN des cellules vivantes sont formées de deux brins antiparallèles enroulés l'un autour de l'autre pour former une double hélice. On dit que l'ADN est bicaténaire, ou double brin. Chacun de ces brins est un polymère appelé polynucléotide. Chaque monomère qui le constitue est un nucléotide, lequel est formé d'une base nucléique, ou base azotée — adénine (A), cytosine (C), guanine (G) ou thymine (T) — liée à un ose — ici, le désoxyribose — lui-même lié à un groupe phosphate. Les nucléotides polymérisés sont unis les uns aux autres par des liaisons covalentes entre le désoxyribose d'un nucléotide et le groupe phosphate du nucléotide suivant, formant ainsi une chaîne où alternent oses et phosphates, avec des bases nucléiques liées chacune à un ose. L'ordre dans lequel se succèdent les nucléotides le long d'un brin d'ADN constitue la séquence de ce brin. C'est cette séquence qui porte l'information génétique. Celle-ci est structurée en gènes, qui sont exprimés à travers la transcription en ARN. Ces ARN peuvent être non codants — ARN de transfert et ARN ribosomique notamment — ou bien codants : il s'agit dans ce cas d'ARN messagers, qui sont traduits en protéines par des ribosomes. La succession des bases nucléiques sur l'ADN détermine la succession des acides aminés qui constituent les protéines issues de ces gènes. La correspondance entre bases nucléiques et acides aminés est le code génétique. L'ensemble des gènes d'un organisme constitue son génome."
wiki_dutch = "Desoxyribonucleïnezuur, beter bekend als DNA,[a] is het biologische macromolecuul dat in alle levende cellen de basis vormt van erfelijkheid. DNA is een zeer lang polymeer, en bevat de genetische instructies voor de ontwikkeling, het functioneren, de groei en de voortplanting van alle bekende organismen en vele virussen. DNA heeft een ingewikkelde chemische structuur. Het is opgebouwd uit twee ketens van nucleotiden, die in de vorm van een dubbele helix met elkaar vervlochten zijn. Een nucleotide bestaat uit een van de vier stikstofbasen (adenine, guanine, thymine of cytosine), een suikergroep genaamd desoxyribose, en een fosfaatgroep. De desoxyribose en de fosfaatgroep verbinden de nucleotiden in een keten aan elkaar en vormen de 'ruggengraat' van het DNA. De basen liggen tegenover elkaar, waarbij A altijd paart met T en G altijd met C. De volgorde van de basen in het DNA vormt een code die het organisme informatie geeft hoe het eiwitten kan maken. Eiwitten bepalen op hun beurt alle verrichtingen en de structuur van de cel. Een stuk DNA dat voor een bepaalde eigenschap codeert, vormt een gen. De expressie van een gen, die via transcriptie en translatie verloopt, wordt zeer precies gereguleerd. In de cellen van dieren, planten en andere eukaryoten is het DNA opgedeeld in een aantal losse strengen, de chromosomen. In een chromosoom is het DNA in hoge mate opgevouwen en opgerold rond eiwitten. Voorafgaand aan iedere celdeling zullen de chromosomen in hun geheel gekopieerd worden, een proces genaamd DNA-replicatie, en vervolgens verdeeld worden over iedere dochtercel. Bij eukaryoten ligt het DNA opgeslagen in de celkern, terwijl het bij bacteriën en archaea los in het cytoplasma voorkomt, vaak als een circulair chromosoom."
wiki_west_flemish = "De primaire structuur van DNA is de volgorde van de nucleotiedn. Een nucleotiede es ip zyn beurt ipgebouwd uut 3 bouwstêenn: de fosfoatgroep, nen vuufoekign suker (2-deoxyribose), en een boase. Der zyn 4 sôortn boasn: twêe purines (bestoande uut nen dubbel aromoatische ring) adenine (A) en guanine (G), en twêe pyrimidines (bestoande uut êne aromoatische ring): cytosine (C) en thymine (T). Der komn ook vele modificoaties voor: 5-methylcytosine, gemethyleerde basen, inosine en vele andere zyn ni zeldzaam en komn by virusn vele voren vo under genoom te beschermn tegen restrictie (of verknippieng) van under DNA deur et gastheerorganisme. De lange keetn dat er ozô gevormd weirdt, vormt nen dubbele helix woarin dat twêe DNA-keetns in een helixvorme udder round elkoar windn. Normoal vormn de twêe strengn een rechtsschroevige dubbele helix (A-DNA en B-DNA), moar in sommige vormn ze nen linksschroevign helix (Z-DNA). B-DNA is de vorm die et mêest voorkomt. Belangryk om ip te merkn es da de twêe strengn in een verschillende richtienge goan: de richtienge van nen DNA-keetn weirdt aangeduud deur de anechtienge van de fosfoatgroep an de suker (ofwel an de 5' koolstof, ofwel an de 3' koolstof). Deurda da nie symmetrisch es, eit nen keetn een bepoalde richtienge. Normoal weirdt die richtienge angegeevn van de 5'-kant noa de 3'-kant. En by nen dubbele helix zie je die keetn in antiparallel teegnover elkoar stoan"
wiki_spanish = "El ácido desoxirribonucleico —conocido por las siglas ADN— es un ácido nucleico que contiene las instrucciones genéticas fundamentales para el desarrollo, funcionamiento y reproducción de todos los seres vivos[1]​ y algunos virus (los virus ADN); también es responsable de la transmisión hereditaria.[2]​ La función principal de la molécula de ADN es el almacenamiento a largo plazo de información para construir otros componentes de las células, como las proteínas y las moléculas de ARN. Los segmentos de ADN que llevan esta información genética son llamados genes, pero las otras secuencias de ADN tienen propósitos estructurales o toman parte en la regulación del uso de esta información genética y biológica. Desde el punto de vista químico, el ADN es un polímero de nucleótidos, es decir, un polinucleótido.[3]​ Cada nucleótido, a su tiempo, está formado por un glúcido (la desoxirribosa), una base nitrogenada (que puede ser adenina→A, timina→T, citosina→C o guanina→G) y un grupo fosfato (derivado del ácido fosfórico). Lo que distingue a un polinucleótido de otro es, entonces, la base nitrogenada, y por ello la secuencia del ADN se especifica nombrando solo la secuencia de sus bases. La disposición secuencial de estas cuatro bases a lo largo de la cadena es la que codifica la información genética, siguiendo el siguiente criterio de complementariedad: A‑T y G‑C. Esto se debe a que la adenina y la guanina son de mayor tamaño que la timina y la citosina, por lo que este criterio permite cumplir una uniformidad. En los seres vivos, el ADN se presenta como una doble cadena de nucleótidos, en la que las dos hebras están unidas entre sí por unas conexiones denominadas puentes de hidrógeno.[4]​[5]​ Para que la información que contiene el ADN pueda ser utilizada por la maquinaria celular debe copiarse en primer lugar en unos trenes de nucleótidos, más cortos y con unas unidades diferentes, llamados ARN. Las moléculas de ARN se copian exactamente del ADN mediante un proceso denominado transcripción. Una vez procesadas en el núcleo celular, las moléculas de ARN pueden salir al citoplasma para su utilización posterior. La información contenida en el ARN se interpreta usando el código genético, que especifica la secuencia de los aminoácidos de las proteínas, según una correspondencia de un triplete de nucleótidos (codón) para cada aminoácido. Esto es, la información genética (esencialmente: qué proteínas se van a producir en cada momento del ciclo de vida de una célula) se halla codificada en las secuencias de nucleótidos del ADN y debe traducirse para poder funcionar. Tal traducción se realiza usando el código genético a modo de diccionario. El diccionario «secuencia de nucleótido-secuencia de aminoácidos» permite el ensamblado de largas cadenas de aminoácidos (las proteínas) en el citoplasma de la célula. Por ejemplo, en el caso de la secuencia de ADN indicada antes (ATGCTAGCATCG...), la ADN polimerasa utilizaría como molde la cadena complementaria de dicha secuencia de ADN (que sería TAC‑GAT‑CGT‑AGC‑...) para transcribir una molécula de ARNm que se leería AUG‑CUA‑GCA‑UCG‑...; el ARNm resultante, utilizando el código genético, se traduciría como la secuencia de aminoácidos"
wiki_portuguese = "O ácido desoxirribonucleico (ADN, em português: ácido desoxirribonucleico[nota 1]; ou DNA, em inglês: deoxyribonucleic acid) é um polímero composto por duas cadeias polinucleotídicas que se enrolam umas sobre as outras para formar uma dupla hélice. O polímero carrega instruções genéticas para o desenvolvimento, funcionamento, crescimento e reprodução de todos os organismos conhecidos e muitos vírus. O ADN e o ácido ribonucleico (RNA) são ácidos nucleicos. Ao lado de proteínas, lipídios e carboidratos complexos (polissacarídeos), os ácidos nucléicos são um dos quatro principais tipos de macromoléculas essenciais para todas as formas de vida conhecidas. É um composto orgânico cujas moléculas contêm as instruções genéticas que coordenam o desenvolvimento e funcionamento de todos os seres vivos e alguns vírus, e que transmitem as características hereditárias de cada ser vivo. A sua principal função é armazenar as informações necessárias para a construção das proteínas de ARNs. Os segmentos de ADN que contêm a informação genética são denominados genes. O restante da sequência de ADN tem importância estrutural ou está envolvido na regulação do uso da informação genética. A estrutura da molécula de ADN foi originalmente descoberta por Rosalind Franklin. No entanto, o Prémio Nobel de Fisiologia ou Medicina de 1962 foi entregue ao norte-americano James Watson e ao britânico Francis Crick, que se inspiraram em Franklin e demonstraram o funcionamento e a estrutura em dupla hélice do ADN em 7 de Março de 1953, juntamente com Maurice Wilkins."
wiki_simple_english = "DNA, short for deoxyribonucleic acid, is the molecule that contains the genetic code of living organisms. This includes animals, plants, protists, archaea and bacteria. It is made up of two polynucleotide chains in a double helix. DNA is in each cell in the organism and tells cells what proteins to make. Mostly, these proteins are enzymes. DNA is inherited by children from their parents. This is why children share traits with their parents, such as skin, hair and eye color. The DNA in a person is a combination of the DNA from each of their parents. Part of an organism's DNA is non-coding DNA sequences. They do not code for protein sequences. Some noncoding DNA is transcribed into non-coding RNA molecules, such as transfer RNA, ribosomal RNA, and regulatory RNAs.[2] Other sequences are not transcribed at all, or give rise to RNA of unknown function. The amount of non-coding DNA varies greatly among species. For example, over 98% of the human genome is non-coding DNA,[3] while only about 2% of a typical bacterial genome is non-coding DNA. Viruses use either DNA or RNA to infect organisms.[4] The genome replication of most DNA viruses takes place in the cell's nucleus, whereas RNA viruses usually replicate in the cytoplasm."

wiki_texts = Dict(
    "english" => clean_text(wiki_english),
    "german" => clean_text(wiki_german),
    "french" => clean_text(wiki_french),
    "dutch" => clean_text(wiki_dutch),
    "west-flemish" => clean_text(wiki_west_flemish),
    "spanish" => clean_text(wiki_spanish),
    "simple english" => clean_text(wiki_simple_english),
    "portuguese" => clean_text(wiki_portuguese)
)

wiki = wiki_texts["dutch"]

function kmers(string, k; remove_spaces=true)
    if remove_spaces
        string = replace(string, r"\s" => "")
    end
    # to deal with pesty Unicode chars...
    chars = [c for c in string]
    n = length(chars)
    return (join(chars[i:i+k-1]) for i in 1:n-k+1)
end

collect(kmers(wiki, 3))

k = 3

hv_texts = Dict(l => bundle(hv.(kmers(s, k))) for (l, s) in wiki_texts)

text_similarities = [(sim(v1, v2), l1, l2) for (l1, v1) in hv_texts for (l2, v2) in hv_texts if l1 > l2]

text_similarities |> sort! |> reverse!

# add heatmap

sentences = [
    "In een normale situatie liggen de twee ketens van het DNA-molecuul tegenover elkaar.",
    "De volgorde van de basen in het DNA vormt een soort van code die het organisme informatie geeft hoe het eiwitten kan maken.",
    "Om basenparing mogelijk te maken, moeten de twee nucleotideketens in omgekeerde richting tegenover elkaar liggen.",
    "Dit is de meest energiegunstige conformatie waarop de basen een interactie met elkaar kunnen aangaan binnen de helix.",
    "DNA-moleculen zijn extreem lang in vergelijking met hun diameter."] .|> clean_text

hv_dutch = hv_texts["dutch"]

hv_sentences = [bundle((hv(km) for km in kmers(s, k))) for s in sentences]

for (s, v) in zip(sentences, hv_sentences)
    println(s, " : sim = ", sim(v, hv_dutch))
end